---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Arduino Projects - John F Denton" description="Arduino and robotics projects by John [Last Name]">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-12 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-primary-400 mb-4">
        Arduino Projects
      </h1>
      <p class="text-xl text-neutral-300 max-w-2xl mx-auto">
        Exploring the intersection of hardware and software through hands-on robotics and electronics.
      </p>
    </div>

    <!-- Project 1: Baby Feeding & Nap Timer -->
    <article class="bg-neutral-800 rounded-lg p-8 border border-neutral-700 shadow-lg mb-8">
      <h2 class="text-3xl font-bold text-primary-400 mb-4">Baby Feeding & Nap Timer</h2>
      <p class="text-neutral-300 text-lg mb-6 leading-relaxed">
        A two-button tracking device that monitors elapsed time since baby's last feeding and nap using a real-time clock and LCD display. Data persists through power loss via EEPROM storage.
      </p>

      <div class="mb-6">
        <h3 class="text-xl font-semibold text-secondary-400 mb-3">Key Features</h3>
        <ul class="list-disc list-inside text-neutral-300 space-y-2">
          <li>Dual countdown timers on 16×2 LCD</li>
          <li>Real-time clock for power outages</li>
          <li>Fast-forward by holding buttons</li>
          <li>Non-volatile memory</li>
          <li>Two pushbuttons interface</li>
        </ul>
      </div>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Hardware Components</summary>
        <ul class="mt-4 list-disc list-inside text-neutral-300 space-y-2">
          <li>Arduino Uno</li>
          <li>DS1302 RTC module with CR2032 battery</li>
          <li>16×2 LCD (HD44780)</li>
          <li>10kΩ potentiometer</li>
          <li>2 pushbuttons</li>
          <li>Breadboard</li>
        </ul>
      </details>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Wiring Details</summary>
        <div class="mt-4 text-neutral-300 space-y-2">
          <p><strong class="text-secondary-400">LCD:</strong> RS→Pin 12, E→Pin 11, D4-7→Pins 10,9,8,13</p>
          <p><strong class="text-secondary-400">Buttons:</strong> Feed→Pin 2, Nap→Pin 3</p>
          <p><strong class="text-secondary-400">RTC:</strong> CLK→Pin 6, DAT→Pin 5, RST→Pin 4</p>
        </div>
      </details>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Operation</summary>
        <div class="mt-4 text-neutral-300 space-y-2">
          <p>Display shows <code class="bg-neutral-800 px-2 py-1 rounded text-primary-300">Feed: HH:MM:SS / Nap: HH:MM:SS</code></p>
          <p><strong class="text-secondary-400">Quick press:</strong> Resets timer</p>
          <p><strong class="text-secondary-400">Hold 0.5s:</strong> Fast-forward mode</p>
        </div>
      </details>
      <details class="bg-neutral-900 p-4 rounded border border-neutral-600 mt-4 mb-4">
        <summary class="cursor-pointer text-primary-400 font-semibold hover:text-primary-300">View Complete User Manual</summary>
        <div class="text-sm text-neutral-300 mt-4 space-y-4">
          <h4 class="font-semibold text-secondary-400">Basic Operation</h4>
          <p>The screen shows two timers counting upward representing time since last feeding and time since last nap:</p>
          <pre class="text-primary-400 font-mono text-xs bg-neutral-950 p-2 rounded">Feed: HH:MM:SS
Nap:  HH:MM:SS</pre>

          <h4 class="font-semibold text-secondary-400 mt-4">Resetting a Timer</h4>
          <ul class="list-disc list-inside space-y-2">
            <li><strong>Feeding Button (D2):</strong> Press once to reset feed timer to 00:00:00. Hold 0.5+ seconds for fast-forward mode.</li>
            <li><strong>Nap Button (D3):</strong> Press once to reset nap timer to 00:00:00. Hold 0.5+ seconds for fast-forward mode.</li>
          </ul>

          <h4 class="font-semibold text-secondary-400 mt-4">Fast-Forward Mode</h4>
          <p>If you forgot to press the button earlier, the device can catch up:</p>
          <ul class="list-disc list-inside space-y-1">
            <li>Holding a button for 0.5 seconds activates fast-forward mode</li>
            <li>Timer advances by 1 minute every 0.2 seconds (display updates in real-time)</li>
            <li>Release the button to stop fast-forward</li>
          </ul>

          <h4 class="font-semibold text-secondary-400 mt-4">Power Loss Behavior</h4>
          <p>The DS1302 RTC stores time using its own battery. The Arduino saves timestamps to EEPROM. You can unplug the device, move it, and plug it back in - both timers resume correctly based on real elapsed time. No need to set the clock again.</p>

          <h4 class="font-semibold text-secondary-400 mt-4">Troubleshooting</h4>
          <ul class="list-disc list-inside space-y-2">
            <li><strong>LCD shows blocks or very faint:</strong> Adjust the 10kΩ potentiometer</li>
            <li><strong>Timers reset after power loss:</strong> CR2032 battery missing/dead, check RTC wiring</li>
            <li><strong>Buttons don't register:</strong> Check GND connection, shorten jumper wires</li>
            <li><strong>RTC time wrong:</strong> Upload sketch with rtc.time() setter, then remove it</li>
          </ul>
        </div>
      </details>

      <details class="bg-neutral-900 p-4 rounded border border-neutral-600 mt-4">
        <summary class="cursor-pointer text-primary-400 font-semibold hover:text-primary-300">View Complete Arduino Code</summary>
        <pre class="text-xs text-neutral-300 overflow-x-auto mt-4 p-4 bg-neutral-950 rounded"><code>#include &lt;LiquidCrystal.h&gt;
#include &lt;DS1302.h&gt;
#include &lt;EEPROM.h&gt;

// LCD pins: RS, E, D4, D5, D6, D7
LiquidCrystal lcd(12, 11, 10, 9, 8, 13);

// DS1302 pins: CE, IO, SCLK
DS1302 rtc(4, 5, 6);

// Button pins
const int feedingButtonPin = 2;
const int napButtonPin = 3;

// States
bool lastFeedingState = HIGH;
bool lastNapState = HIGH;

// Times (unix timestamps)
unsigned long feedingStart = 0;
unsigned long napStart = 0;

// Hold tracking
unsigned long feedPressedTime = 0;
unsigned long napPressedTime = 0;

bool feedingHeld = false;
bool napHeld = false;

unsigned long lastFeedAddTime = 0;
unsigned long lastNapAddTime = 0;

// Constants
const unsigned long holdThreshold = 500;       // ms
const unsigned long incrementInterval = 200;   // ms
const unsigned long oneMinute = 60;             // seconds

// EEPROM addresses (4 bytes each)
const int EEPROM_FEEDING_ADDR = 0;
const int EEPROM_NAP_ADDR = 4;

void setup() &#123;
  pinMode(feedingButtonPin, INPUT_PULLUP);
  pinMode(napButtonPin, INPUT_PULLUP);

  lcd.begin(16, 2);
  Serial.begin(9600);

  rtc.halt(false);
  rtc.writeProtect(false);

  // Read stored timestamps
  EEPROM.get(EEPROM_FEEDING_ADDR, feedingStart);
  EEPROM.get(EEPROM_NAP_ADDR, napStart);

  // Validate EEPROM values; if invalid, initialize to current RTC time
  Time nowTime = rtc.time();
  unsigned long now = nowTime.unixtime();

  if (feedingStart == 0xFFFFFFFF || feedingStart == 0) feedingStart = now;
  if (napStart == 0xFFFFFFFF || napStart == 0) napStart = now;
&#125;

void loop() &#123;
  Time nowTime = rtc.time();
  unsigned long currentTime = nowTime.unixtime();

  // Feeding button logic
  bool currentFeedingState = digitalRead(feedingButtonPin);
  if (lastFeedingState == HIGH &amp;&amp; currentFeedingState == LOW) &#123;
    feedPressedTime = millis();
    feedingHeld = false;
  &#125; else if (lastFeedingState == LOW &amp;&amp; currentFeedingState == LOW) &#123;
    if (!feedingHeld &amp;&amp; (millis() - feedPressedTime &gt;= holdThreshold)) &#123;
      feedingHeld = true;
      lastFeedAddTime = millis();
    &#125;
    if (feedingHeld &amp;&amp; (millis() - lastFeedAddTime &gt;= incrementInterval)) &#123;
      feedingStart -= oneMinute;
      lastFeedAddTime = millis();
      EEPROM.put(EEPROM_FEEDING_ADDR, feedingStart);
    &#125;
  &#125; else if (lastFeedingState == LOW &amp;&amp; currentFeedingState == HIGH) &#123;
    if (!feedingHeld) &#123;
      feedingStart = currentTime;
      EEPROM.put(EEPROM_FEEDING_ADDR, feedingStart);
    &#125;
  &#125;
  lastFeedingState = currentFeedingState;

  // Nap button logic
  bool currentNapState = digitalRead(napButtonPin);
  if (lastNapState == HIGH &amp;&amp; currentNapState == LOW) &#123;
    napPressedTime = millis();
    napHeld = false;
  &#125; else if (lastNapState == LOW &amp;&amp; currentNapState == LOW) &#123;
    if (!napHeld &amp;&amp; (millis() - napPressedTime &gt;= holdThreshold)) &#123;
      napHeld = true;
      lastNapAddTime = millis();
    &#125;
    if (napHeld &amp;&amp; (millis() - lastNapAddTime &gt;= incrementInterval)) &#123;
      napStart -= oneMinute;
      lastNapAddTime = millis();
      EEPROM.put(EEPROM_NAP_ADDR, napStart);
    &#125;
  &#125; else if (lastNapState == LOW &amp;&amp; currentNapState == HIGH) &#123;
    if (!napHeld) &#123;
      napStart = currentTime;
      EEPROM.put(EEPROM_NAP_ADDR, napStart);
    &#125;
  &#125;
  lastNapState = currentNapState;

  // Calculate elapsed times
  unsigned long feedElapsed = currentTime - feedingStart;
  unsigned long napElapsed = currentTime - napStart;

  // Display on LCD
  displayElapsedTime(0, "Feed: ", feedElapsed);
  displayElapsedTime(1, "Nap:  ", napElapsed);

  delay(50);
&#125;

void displayElapsedTime(int row, const char* label, unsigned long elapsedSeconds) &#123;
  unsigned long hours = elapsedSeconds / 3600;
  unsigned long minutes = (elapsedSeconds % 3600) / 60;
  unsigned long seconds = elapsedSeconds % 60;

  lcd.setCursor(0, row);
  lcd.print(label);

  if (hours &lt; 10) lcd.print('0');
  lcd.print(hours);
  lcd.print(':');

  if (minutes &lt; 10) lcd.print('0');
  lcd.print(minutes);
  lcd.print(':');

  if (seconds &lt; 10) lcd.print('0');
  lcd.print(seconds);
  lcd.print("  ");
&#125;</code></pre>
      </details>
    </article>

    <!-- Project 2: Toddler Sleep Clock -->
    <article class="bg-neutral-800 rounded-lg p-8 border border-neutral-700 shadow-lg mb-8">
      <h2 class="text-3xl font-bold text-primary-400 mb-4">Toddler Sleep Clock</h2>
      <p class="text-neutral-300 text-lg mb-6 leading-relaxed">
        A custom microcontroller-based alarm clock using color cues to help young children understand sleep schedules with color transitions.
      </p>

      <div class="mb-6">
        <h3 class="text-xl font-semibold text-secondary-400 mb-3">Key Features</h3>
        <ul class="list-disc list-inside text-neutral-300 space-y-2">
          <li>Morning (Red→Amber→Green) and Evening (Green→Amber→Red) progressions</li>
          <li>Daytime power saving</li>
          <li>Smooth 10-second LED transitions</li>
          <li>Backup battery</li>
          <li>Three-button configuration menu</li>
        </ul>
      </div>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Hardware Components</summary>
        <ul class="mt-4 list-disc list-inside text-neutral-300 space-y-2">
          <li>Arduino Uno</li>
          <li>DS1302 RTC with CR2032</li>
          <li>16x2 LCD (HD44780)</li>
          <li>RGB LED (common cathode KY-016)</li>
          <li>3 push buttons</li>
          <li>4x 220Ω resistors</li>
          <li>10kΩ pot</li>
        </ul>
      </details>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Wiring Details</summary>
        <div class="mt-4 text-neutral-300 space-y-2">
          <p><strong class="text-secondary-400">Buttons:</strong> D2, D3, D4 to ground</p>
          <p><strong class="text-secondary-400">RGB LED:</strong> R→D9, G→D10, B→D8</p>
          <p><strong class="text-secondary-400">RTC:</strong> Clock→D7, Data→D6, Reset→D5</p>
          <p><strong class="text-secondary-400">LCD:</strong> RS→D12, Enable→D11, Data→A0-A3</p>
        </div>
      </details>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Software & Setup</summary>
        <div class="mt-4 text-neutral-300 space-y-3">
          <p><strong class="text-secondary-400">Libraries:</strong> LiquidCrystal, Rtc by Makuna, EEPROM</p>
          <p><strong class="text-secondary-400">Setup:</strong> Hold SELECT 1s (LED turns blue), use UP/DOWN to adjust, SELECT to confirm</p>
        </div>
      </details>

      <details class="bg-neutral-900 rounded-lg p-6 border border-neutral-700 mb-4">
        <summary class="text-lg font-semibold text-primary-400 cursor-pointer hover:text-primary-300">Configuration Options</summary>
        <ul class="mt-4 list-disc list-inside text-neutral-300 space-y-2">
          <li>Current time</li>
          <li>Wake amber/green times</li>
          <li>Bedtime amber/red times</li>
          <li>Optional nap times</li>
        </ul>
      </details>
      <details class="bg-neutral-900 p-4 rounded border border-neutral-600 mt-4 mb-4">
        <summary class="cursor-pointer text-primary-400 font-semibold hover:text-primary-300">View Complete User Manual</summary>
        <div class="text-sm text-neutral-300 mt-4 space-y-4">
          <h4 class="font-semibold text-secondary-400">Normal Operation</h4>
          <ul class="list-disc list-inside space-y-1">
            <li><strong>Top Line:</strong> Displays current time</li>
            <li><strong>Bottom Line:</strong> Displays next event (Wake or Bedtime)</li>
            <li><strong>LED:</strong> Changes color automatically based on schedule</li>
          </ul>

          <h4 class="font-semibold text-secondary-400 mt-4">Entering Setup Mode</h4>
          <ul class="list-disc list-inside space-y-1">
            <li>Press and hold SELECT for 1 second</li>
            <li>LED will turn Blue</li>
            <li>Use UP/DOWN to adjust the flashing number</li>
            <li>Press SELECT to confirm and move to next setting</li>
          </ul>

          <h4 class="font-semibold text-secondary-400 mt-4">Setup Sequence</h4>
          <ol class="list-decimal list-inside space-y-1">
            <li>Set Time: Adjust current Hour → Minute</li>
            <li>Set Wake (R→Y): When light turns Amber (Wake up soon)</li>
            <li>Set Wake (Y→G): When light turns Green (Okay to get up)</li>
            <li>Set Bed (G→Y): When light turns Amber (Wind down/Evening)</li>
            <li>Set Bed (Y→R): When light turns Red (Bedtime)</li>
          </ol>

          <h4 class="font-semibold text-secondary-400 mt-4">Power Saving</h4>
          <p>Lights automatically fade to OFF 2 hours after morning "Green" time. Lights fade back ON 2 hours before evening "Amber" time.</p>

          <h4 class="font-semibold text-secondary-400 mt-4">Nap Feature</h4>
          <p><strong>Setup:</strong></p>
          <ul class="list-disc list-inside space-y-1">
            <li>Screen 1: "Total Naps?" → Choose 0, 1, or 2</li>
            <li>If 1 nap selected: Set "Nap 1 Start" and "Nap 1 End"</li>
            <li>If 2 naps selected: Set both nap start/end times</li>
          </ul>
          <p><strong>Nap Colors:</strong></p>
          <ul class="list-disc list-inside space-y-1">
            <li>15 mins before nap: Light turns Amber</li>
            <li>Nap Time: Light turns Red</li>
            <li>Nap End: Light turns Green (stays green for 1+ hour)</li>
          </ul>
        </div>
      </details>

      <details class="bg-neutral-900 p-4 rounded border border-neutral-600 mt-4">
        <summary class="cursor-pointer text-primary-400 font-semibold hover:text-primary-300">View Complete Arduino Code</summary>
        <pre class="text-xs text-neutral-300 overflow-x-auto mt-4 p-4 bg-neutral-950 rounded"><code>// Toddler Sleep Clock - Complete Arduino Code
// This is a placeholder for the complete Toddler Sleep Clock code
// The actual implementation includes RTC management, LCD display control,
// RGB LED color transitions, EEPROM settings storage, and button input handling</code></pre>
      </details>
    </article>

    <!-- Educational Focus -->
    <div class="mt-8 bg-gradient-to-r from-primary-900/20 to-secondary-900/20 rounded-lg p-6 border border-primary-700/30">
      <div class="flex items-start">
        <svg class="w-6 h-6 text-secondary-400 mr-3 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
        <div>
          <h3 class="text-lg font-semibold text-neutral-200 mb-2">Educational Approach</h3>
          <p class="text-neutral-300 text-sm leading-relaxed">
            These projects demonstrate practical applications of physical computing, combining sensors, displays, and microcontrollers to solve real-world problems.
          </p>
        </div>
      </div>
    </div>
  </div>
</Layout>
